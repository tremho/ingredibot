# Ingredibot API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## builder

Conduct the process of importing ingredients into the DB from a recipe URL

### Parameters

-   `url` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Recipe page url

## compareParsing

Used to help analyse our parsing versus that which was done by Zestful so that we can potentially improve
our effectiveness there.

### Parameters

-   `ingr`  
-   `zInfo`  

## IndexEntry

: `Incredibot_DB.ts`

| property        | type   | default | description                                                    |
| --------------- | ------ | ------- | -------------------------------------------------------------- |
| name            | string | ''      | name of the ingredient                                         |
| mstsEntered     | number | 0       | Javascript timestamp (ms) of when this db entry was created    |
| timesReferenced | number | 0       | number of times this index item was accessed since first entry |
| fdcId           | string | ''      | the food data central code for this food item                  |

## DB_Info

: `Incredibot_DB.ts`

| property | type   | default | description                                      |
| -------- | ------ | ------- | ------------------------------------------------ |
| name     | string | ''      | name of the ingredient                           |
| qty      | number | 0       | quantity in the given unit of measure            |
| unit     | string | ''      | unit of measure the quqntity represents          |
| prep     | string | ''      | string describing preparation or other modifiers |
| fdcId    | string | ''      | the food data central code for this food item    |
| density  | number | 0       | Density ratio of this item (water === 1.0)       |

## loadData

Load a DB record by fdcId

### Parameters

-   `fdcId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;DBInfo>** Promise resolves with DB_Info data or null.

## saveData

Saves the DB_Info data in the bucket under its fdcId

### Parameters

-   `data`  

## loadIndex

Load the DB index

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[IndexEntry](#indexentry)>>** Promise resolves with an array of IndexEntry items or null

## updateIndex

Persist the index to storage.
will write to the cloud if we are beyond our minimum update interval
Should be called on any index update
Should be called with force=true at app close

### Parameters

-   `force`  

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** should not proceed until promise resolves.

## makeIndexMap

Turns the cachedIndex array into map

## setup

Call at start to establish index

## getIngredient

Get an ingredient from our index, if it's there

### Parameters

-   `type` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Name of the ingredient

Returns **([DB_Info](#db_info) \| [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined))** the record we have in stare for this ingredient

## makeNewEntry

### Parameters

-   `info` **[DB_Info](#db_info)** The Zestful parsed data for this ingredient

## shutdown

Perform final persistance before leaving app.

## reconcileIngredient

Turn Ingredient into a reconciled DB_Info ingredient object

### Parameters

-   `ingredient`  

## lookupFood

Lookup data on a food item by its fdcID

### Parameters

-   `fdcId`  Food Data Central Identifier obtained previously

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;any>** USDA Food Data Central data response (see usda food central site for more info)

## findFoodByName

Find data on a food items that match the given name/description string

### Parameters

-   `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Ingredient name

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;any>** USDA Food Data Central data response (see usda food central site for more info)

## parseLines

Call upon the Zestful API to parse an recipe ingredient line.

### Parameters

-   `ingredientLines` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Lines from the recipe to be parsed

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[DB_Info](#db_info)>** Array of corresponding parsed data

## readRecipePage

Read a web page that describes a recipe and that has a `schema.org` `Recipe` type schema within it.

### Parameters

-   `url` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Address of the recipe web page

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** html text of the page source

## findRecipeBlocks

accepts page data ( as from `readRecipePage`) and extracts LD+JSON blocks
from it.  These may or may not be Recipe blocks, but will be LD+JSON segments.

### Parameters

-   `pageData` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Array of extracted block text

## blockToRecipe

Attempts to parse a LD+JSON block as a Recipe object.
Parsed Recipe will include Ingredient elements in `ingredientList` that has first-level (unreconciled)
parsing done to determine name and quqntity.

### Parameters

-   `block`  

## scrape

Extract the Recipe object(s) from a web page recipe article

### Parameters

-   `url`  Url of the recipe browser page

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Recipe](#recipe)>>** an array with the recipes found on this page (usually only one)

## Ingredient

Defines an ingredient as parsed from a recipe line

| property  | type      | default | description                   |
| --------- | --------- | ------- | ----------------------------- |
| text      | string    |         | The ingredient line submitted |
| name      | string    |         | name of the ingredient        |
| quqntity  | Measure   |         | THe unit-measure parsed       |
| modifiers | string\[] | \[]     | Array of extradted modifiers  |

## get

unitModifier represents the `modifiers` array as a space-delimited string
mostly for legacy reasons.

## vulgarFractionReplacer

Used to replace unicode so-called 'vulgar fraction' characters into full numerical fraction notation
that is parseable above.

### Parameters

-   `text` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** String that may contain fraction characters

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** expanded version of the string with character replaced by notation.

## matchableUnits

Similer to the nameMapUnit object of unit-measure, but tailored for kitchen usage
This names the recognized units.
To use: Scan first case-sensitive and then again case-insensitive if no match found first time.
Unlike NameMapUnit there are some case-dependent matches here. (e.g. T vs. t)

## matchableQualifiers

Qualifiers describe a single unit (e.g. an apple) in a generically quantifiable way

## Recipe

Defines an object that has been extracted from a Schema.org Recipe type schema object
`ingredientList` will hold the first-order parse of the listed recipe ingredients as
unreconciled `Ingredient` objects.

| property       | type          | description                                                          |
| -------------- | ------------- | -------------------------------------------------------------------- |
| name           | string        | name of the recipe                                                   |
| url            | string        | original page URL                                                    |
| author         | string        | who wrote this                                                       |
| datePublished  | Date          | date published                                                       |
| dateModified   | Date          | date last updated                                                    |
| publisher Info | Object        | name: string, logo: Image                                            |
| image          | Image         | Title image of the recipe                                            |
| description    | string        | describes the dish                                                   |
| keyords        | string\[]     | may be useful in searches                                            |
| cuisine        | string        | name of the type of cuisine (e.g. Mediterranean)                     |
| category       | string        | name of the food category (e.g. Vegetarian)                          |
| numComments    | number        | how many comments can be found in the related comment section        |
| prepTime       | Duration      | how long it takes to prepare ingredients, and may include wait times |
| cookTime       | Duration      | how long it takes to cook once prep                                  |
| totalTime      | Duration      | how long it takes to prepare and cook, including any wait times.     |
| servings       | number        | number of servings this recipe should make                           |
| ingredientList | Ingredient\[] | recipe ingredient lines parsed into our Ingredient objects           |
| instructions   | string\[]     | series of steps required to prepare the dish.                        |

## execute

PromiseLoop worker function
 (think of as `Promise.each(...)`) but it's not the Bluebird version

### Parameters

-   `listToProcess` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>** 
-   `functionToCall` **ProcessFunction** Must return a promise that will update the intermediate accumulator
